{% extends "layout.html" %}

{% block title %}Log Analysis{% endblock %}

{% block content %}
<div class="bg-gray-800 p-6 rounded-lg shadow-lg">
    <h1 class="text-2xl font-bold text-white mb-4">Datalog Analysis</h1>

    <!-- File Management -->
    <div class="mb-6">
        <h2 class="text-xl font-semibold text-white mb-3">Manage Log Files</h2>
        <!-- Upload Section -->
        <div class="bg-gray-700 p-4 rounded-lg mb-4">
            <label for="log_file_upload" class="block text-gray-400 text-sm font-bold mb-2">Upload a Log File:</label>
            <div class="flex items-center">
                <input type="file" id="log_file_upload" name="log_file_upload" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-500 file:text-white hover:file:bg-blue-600">
                <button id="upload_and_load_btn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded ml-4">Upload & Load</button>
            </div>
        </div>

        <!-- Existing Files Table -->
        <div class="overflow-x-auto">
            <table class="min-w-full bg-gray-900 text-white">
                <thead>
                    <tr>
                        <th class="py-2 px-4 border-b border-gray-700 text-left">Log File</th>
                        <th class="py-2 px-4 border-b border-gray-700 text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file in log_files %}
                    <tr>
                        <td class="py-2 px-4 border-b border-gray-800">{{ file }}</td>
                        <td class="py-2 px-4 border-b border-gray-800 text-center">
                            <button class="load-btn bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded text-sm" data-filename="{{ file }}">Load</button>
                            <a href="{{ url_for('download_log', filename=file) }}" class="download-btn bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-3 rounded text-sm" download>Download</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="2" class="py-4 px-4 text-center text-gray-500">No log files found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- PID Selection -->
    <div id="pid_selection_container" class="hidden">
        <h2 class="text-xl font-semibold text-white mb-3">Select PIDs to Plot</h2>
        <div id="pid_checkboxes" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <!-- Checkboxes will be populated by JavaScript -->
        </div>
        <button id="plot_data_btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Plot Selected PIDs</button>
    </div>

    <!-- Chart and Stats -->
    <div id="analysis_results_container" class="hidden mt-6">
        <div id="plotly_chart_container" class="bg-gray-900 p-4 rounded-lg mb-6">
            <!-- Plotly chart will be injected here -->
        </div>
        <div id="stats_container">
            <h2 class="text-xl font-semibold text-white mb-3">Statistics</h2>
            <div id="stats_table" class="overflow-x-auto">
                <!-- Stats table will be populated by JavaScript -->
            </div>
        </div>
    </div>

</div>

<!-- Plotly.js Library -->
<script src="{{ url_for('static', filename='vendor/plotly-latest.min.js') }}"></script>
<!-- Local script for this page -->
<script src="{{ url_for('static', filename='js/analysis.js') }}"></script>
{% endblock %}
