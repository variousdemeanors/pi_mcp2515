{% extends "layout.html" %}

{% block title %}Fuel Configuration{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-white mb-6">Fuel Calculations Configuration</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="mb-4 p-4 rounded-lg {% if category == 'success' %}bg-green-800 text-green-200{% else %}bg-red-800 text-red-200{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="bg-gray-800 p-6 rounded-lg mb-6">
        <h2 class="text-xl font-semibold text-white mb-4">Engine & Fuel System Parameters</h2>
        <p class="text-gray-300 mb-4">Configure your engine specifications for accurate fuel delivery calculations.</p>
        
        <form method="POST" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="injector_flow_rate" class="block text-sm font-medium text-gray-300 mb-1">
                        Injector Flow Rate (lb/hr @ 43.5 PSI)
                    </label>
                    <input type="number" 
                           id="injector_flow_rate" 
                           name="injector_flow_rate" 
                           step="0.1" 
                           min="1" 
                           max="200"
                           value="{{ fuel_config.injector_flow_rate }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                           required>
                    <p class="text-xs text-gray-400 mt-1">Common values: Stock (36), 550cc (52), 1000cc (95)</p>
                </div>

                <div>
                    <label for="num_cylinders" class="block text-sm font-medium text-gray-300 mb-1">
                        Number of Cylinders
                    </label>
                    <select id="num_cylinders" 
                            name="num_cylinders"
                            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                            required>
                        <option value="3" {% if fuel_config.num_cylinders == 3 %}selected{% endif %}>3</option>
                        <option value="4" {% if fuel_config.num_cylinders == 4 %}selected{% endif %}>4</option>
                        <option value="5" {% if fuel_config.num_cylinders == 5 %}selected{% endif %}>5</option>
                        <option value="6" {% if fuel_config.num_cylinders == 6 %}selected{% endif %}>6</option>
                        <option value="8" {% if fuel_config.num_cylinders == 8 %}selected{% endif %}>8</option>
                        <option value="10" {% if fuel_config.num_cylinders == 10 %}selected{% endif %}>10</option>
                        <option value="12" {% if fuel_config.num_cylinders == 12 %}selected{% endif %}>12</option>
                    </select>
                </div>

                <div>
                    <label for="engine_displacement" class="block text-sm font-medium text-gray-300 mb-1">
                        Engine Displacement (Liters)
                    </label>
                    <input type="number" 
                           id="engine_displacement" 
                           name="engine_displacement" 
                           step="0.1" 
                           min="0.5" 
                           max="10"
                           value="{{ fuel_config.engine_displacement }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                           required>
                    <p class="text-xs text-gray-400 mt-1">Examples: 1.6L, 2.0L, 2.5L, 3.5L, 5.0L</p>
                </div>

                <div>
                    <label for="stoichiometric_afr" class="block text-sm font-medium text-gray-300 mb-1">
                        Stoichiometric AFR
                    </label>
                    <input type="number" 
                           id="stoichiometric_afr" 
                           name="stoichiometric_afr" 
                           step="0.1" 
                           min="10" 
                           max="20"
                           value="{{ fuel_config.stoichiometric_afr }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                           required>
                    <p class="text-xs text-gray-400 mt-1">Gasoline: 14.7, E85: 9.8, Methanol: 6.4</p>
                </div>

                <div>
                    <label for="fuel_density" class="block text-sm font-medium text-gray-300 mb-1">
                        Fuel Density (lb/gal)
                    </label>
                    <input type="number" 
                           id="fuel_density" 
                           name="fuel_density" 
                           step="0.01" 
                           min="4" 
                           max="8"
                           value="{{ fuel_config.fuel_density }}"
                           class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                           required>
                    <p class="text-xs text-gray-400 mt-1">Gasoline: 6.17, E85: 6.59, Methanol: 6.59</p>
                </div>
            </div>

            <div class="flex space-x-4 pt-4">
                <button type="submit" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                    Save Configuration
                </button>
                <a href="{{ url_for('live_data') }}" 
                   class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                    Back to Dashboard
                </a>
            </div>
        </form>
    </div>

    <div class="bg-gray-800 p-6 rounded-lg">
        <h2 class="text-xl font-semibold text-white mb-4">Calculated Metrics</h2>
        <p class="text-gray-300 mb-4">The following fuel metrics will be calculated and displayed on your dashboard:</p>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-gray-700 p-4 rounded-lg">
                <h3 class="font-semibold text-white mb-2">ðŸš— Fuel Flow Rate</h3>
                <p class="text-gray-300 text-sm">Real-time fuel consumption in gallons per hour (GPH) based on MAP sensor data and injector parameters.</p>
            </div>
            
            <div class="bg-gray-700 p-4 rounded-lg">
                <h3 class="font-semibold text-white mb-2">âš¡ Injector Duty Cycle</h3>
                <p class="text-gray-300 text-sm">Percentage of time injectors are open, indicating engine load and fuel system stress.</p>
            </div>
            
            <div class="bg-gray-700 p-4 rounded-lg">
                <h3 class="font-semibold text-white mb-2">â›½ Fuel Economy</h3>
                <p class="text-gray-300 text-sm">Miles per gallon (MPG) calculated from fuel flow and vehicle speed.</p>
            </div>
            
            <div class="bg-gray-700 p-4 rounded-lg">
                <h3 class="font-semibold text-white mb-2">ðŸŽ¯ Volumetric Efficiency</h3>
                <p class="text-gray-300 text-sm">Engine breathing efficiency as a percentage of theoretical maximum airflow.</p>
            </div>
        </div>
        
        <div class="mt-4 p-4 bg-blue-900 rounded-lg">
            <h3 class="font-semibold text-blue-200 mb-2">ðŸ’¡ Note: MAP-Based Calculations</h3>
            <p class="text-blue-200 text-sm">
                Since your vehicle uses a MAP sensor instead of MAF, fuel calculations are performed using the speed-density method. 
                This approach estimates airflow based on manifold pressure, RPM, and engine displacement for accurate fuel delivery calculations.
            </p>
        </div>
    </div>
</div>
{% endblock %}